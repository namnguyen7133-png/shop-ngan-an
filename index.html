<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8">
<title>Shop NgÃ¢n An</title>
<style>
body{font-family:Arial;margin:10px;background:#fafafa; line-height: 1.6;}
h1{text-align:center}
.ká»‡{border:1px solid #ddd;padding:10px;margin-bottom:10px;background:#fff; border-radius: 8px; box-shadow: 2px 2px 5px #eee;}
.admin-only{display:none}
.admin .admin-only{display:block}
button{padding:8px 12px;margin:4px; cursor: pointer; border-radius: 5px; border: 1px solid #ccc;}
input{width:95%;padding:6px;margin-top:6px; border: 1px solid #ddd;}
.grid-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
.img-sp { width: 100%; border-radius: 5px; margin-bottom: 5px; }
.btn-mua { background: #fb5531; color: white; text-decoration: none; padding: 5px 10px; border-radius: 5px; display: inline-block; margin-top: 5px; font-size: 14px; }
</style>
</head>
<body>

<h1>ğŸ› Shop NgÃ¢n An</h1>

<div style="text-align:center; margin-bottom: 20px;">
  <button onclick="unlock()">ğŸ”’ Má» QUáº¢N LÃ</button>
</div>

<div class="admin-only" style="text-align:center; background: #eee; padding: 10px; margin-bottom: 20px;">
  <p><b>CHáº¾ Äá»˜ XEM:</b></p>
  <button onclick="changeMode('auto')" style="background: #4CAF50; color:white;">âš™ï¸ Tá»ª GOOGLE SHEET (Tá»° Äá»˜NG)</button>
  <button onclick="changeMode('manual')" style="background: #2196F3; color:white;">âœï¸ Tá»° GÃ• TAY (THá»¦ CÃ”NG)</button>
</div>

<div id="shelves" class="grid-container">
    <p style="text-align:center; width: 100%;">Äang káº¿t ná»‘i tá»§ Ä‘á»“...</p>
</div>

<script>
const SHOP_KEY="ngan-an";
const ADMIN_PASSWORD="1234";
const TOTAL=32;
const SHEET_CSV = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQFCL1NiCeMNUGWbtkzgUgsQIdhjbASXoard37mTu0QQQFxUr1YjI7PSsMNdjDu2hRydSWbx-Ezaypa/pub?gid=0&single=true&output=csv";

let mode="auto"; 
let sheetData = [];

// 1. HÃ m má»Ÿ khÃ³a Admin
function unlock(){
 if(prompt("Máº­t kháº©u quáº£n lÃ½:")===ADMIN_PASSWORD){
  document.body.classList.add("admin");
  alert("ÄÃ£ má»Ÿ quáº£n lÃ½ Shop NgÃ¢n An");
 }
}

// 2. HÃ m lÆ°u vÃ  táº£i dá»¯ liá»‡u DÃN TAY (LocalStorage)
function save(i,d){localStorage.setItem(SHOP_KEY+i,JSON.stringify(d)); render();}
function load(i){return JSON.parse(localStorage.getItem(SHOP_KEY+i)||"null")}

// 3. HÃ m láº¥y dá»¯ liá»‡u tá»« Google Sheet
async function fetchSheet() {
    try {
        const response = await fetch(SHEET_CSV);
        const text = await response.text();
        const rows = text.split("\n").slice(2); // Bá» 2 dÃ²ng Ä‘áº§u
        sheetData = rows.map(row => {
            const cols = row.split(",");
            return {
                name: cols[0]?.trim(),
                img: cols[1]?.trim(),
                price: cols[2]?.trim(),
                link: cols[3]?.trim(),
                status: cols[4]?.trim()
            };
        });
        render();
    } catch (e) {
        console.error("Lá»—i láº¥y dá»¯ liá»‡u Sheet");
    }
}

// 4. HÃ m thay Ä‘á»•i cháº¿ Ä‘á»™ xem
function changeMode(m) {
    mode = m;
    render();
}

// 5. HÃ m hiá»ƒn thá»‹ hÃ ng lÃªn web
function render(){
 const box=document.getElementById("shelves");
 box.innerHTML="";

 if (mode === "auto") {
    // CHáº¾ Äá»˜ Tá»° Äá»˜NG: Láº¥y tá»« Sheet
    sheetData.forEach((p, index) => {
        if (p.status === "1" && p.name) {
            box.innerHTML += `
            <div class="ká»‡">
                <img src="${p.img}" class="img-sp" onerror="this.src='https://via.placeholder.com/150?text=Anh-Cho-Duyet'">
                <b>${p.name}</b><br>
                <span style="color:red">${p.price}</span><br>
                <a class="btn-mua" href="${p.link}" target="_blank">ğŸ›’ Mua ngay</a>
            </div>`;
        }
    });
    if(box.innerHTML==="") box.innerHTML="<p>Tá»§ Ä‘á»“ tá»± Ä‘á»™ng Ä‘ang trá»‘ng. HÃ£y báº­t '1' á»Ÿ cá»™t E trÃªn Sheet.</p>";
 } else {
    // CHáº¾ Äá»˜ DÃN TAY: Láº¥y tá»« LocalStorage
    for(let i=1;i<=TOTAL;i++){
        const saved=load(i);
        box.innerHTML+=`
        <div class="ká»‡">
            <b>Ká»‡ ${i}</b><br>
            ${saved ? `${saved.name} â€“ ${saved.price}<br><a class="btn-mua" href="${saved.link}" target="_blank">ğŸ‘‰ Mua</a>` : "<i>Trá»‘ng</i>"}
            <div class="admin-only">
                <input id="n${i}" placeholder="TÃªn" value="${saved?.name||""}">
                <input id="g${i}" placeholder="GiÃ¡" value="${saved?.price||""}">
                <input id="l${i}" placeholder="Link áº£nh hoáº·c Link SP" value="${saved?.link||""}">
                <button onclick="save(${i},{name:n${i}.value,price:g${i}.value,link:l${i}.value})">ğŸ’¾ LÆ°u</button>
            </div>
        </div>`;
    }
 }
}

// Khá»Ÿi cháº¡y
fetchSheet();
</script>
</body>
</html>
